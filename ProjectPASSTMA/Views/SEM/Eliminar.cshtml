@model ENTIDAD.SEMCE

@{
    ViewBag.Title = "Jefatura";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Jefatura</h2>

<h3>¿Está seguro de eliminar esto?</h3>
<div>
    <h4>Eliminar Jefatura</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            ID
        </dt>

        <dd>
            @Html.DisplayFor(model => model.IdSEM)
        </dd>

        <dt>
            NOMBRE
        </dt>

        <dd>
            @Html.DisplayFor(model => model.NombreSEM)
        </dd>

        <dt>
            SE/GERENCIA
        </dt>

        <dd>
            @Html.DisplayFor(model => model.NombreUUNN)
        </dd>

        <dt>
            UN/SEM
        </dt>

        <dd>
            @Html.DisplayFor(model => model.NombreSEDE)
        </dd>
        <dt>
            RESPONSABLE
        </dt>

        <dd>
            @Html.DisplayFor(model => model.NombreResponsable)
        </dd>

    </dl>

    <form action="@Url.Action("Eliminar", "SEM")" method="post" id="frmSEM">
        @Html.AntiForgeryToken()
        <div class="form-group">
            <div class="col-md-offset-2 col-md-12">
                <input type="submit" value="Eliminar" class="btn btn-danger" />
            </div>
        </div>
        <p>
            <a class="btn btn-default" href="@Url.Action("Index", "SEM")"><i class="glyphicon glyphicon-menu-left"></i>Volver</a>
        </p>
    </form>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $("#frmSEM").submit(function (event) {
            event.preventDefault(); //evitar la acción predeterminada para que la pagina no se sobrecargue

            var post_url = $(this).attr("action"); //action url del formulario
            var request_method = $(this).attr("method"); //método GET/POST del formulario
            var form_data = $(this).serializeArray(); //Codificando elementos de formulario para su envío
            console.log(form_data);
            LoadingOverlayShow("#frmSEM"); /* MOSTRAR estado de carga   */
            $.ajax({
                url: post_url,
                type: request_method,
                data: form_data
            }).done(function (response) { //
                console.log(response);
                //LoadingOverlayHide("#frmSEM_ACTIVIDAD"); /*   OCULTAR estado de carga   */
                if (response.ok) {
                    alert("La Jefatura ha sido eliminada.");
                    window.location = response.toRedirect;
                }
                else {
                    let rsp = response.msg;
                    let cont = "The DELETE statement conflicted with the REFERENCE constraint";
                    let trad = "La declaración ELIMINAR entró en conflicto con la restricción 'FK_SEM_ACTIVIDAD_SEM1'.";
                    if (rsp.includes(cont))
                        alert("No es posible eliminar esta Jefatura porque actualmente está relacionada a una Asignación de Actividad. \nError: " + trad);
                    else
                        alert("EL PROCESO NO PUEDE COMPLETARSE DEBIDO A ESTE ERROR: \n" + rsp);
                    window.location = response.toRedirect;
                }
            }).fail(function (jqXHR, textStatus, errorThrown) {
                LoadingOverlayHide("#frmSEM");
            });
        });

    </script>
}